<template>
<uni-shadow-root class="lin-ui-dist-combined-tabs-index"><view :class="'l-tabs l-placement-top l-tabs-horizontal '+(aminmated ? 'l-aminmated' :'')+' '+(scrollable ? 'l-tabs-scroll':'')">
    <tab-header v-bind="{tab:tabList,placemanet,scrollable,transformY,transformX,activeKey,hasLine,activeColor,inactiveColor,headerType:'tab'}" wx-template-name="tab-header"></tab-header>
    <view :class="'l-tabs l-sub-placement-left l-tabs-vertical '+(aminmated ? 'l-aminmated' :'')+' '+(scrollable ? 'l-tabs-scroll':'')">
        <tab-header v-bind="{tab:tabList[currentIndex].subTabs,placemanet,scrollable,transformY,transformX,activeKey:tabList[currentIndex].activeSubKey,hasLine,activeColor,inactiveColor,headerType:'subTab'}" v-if="tabList[currentIndex].subTabs.length" wx-template-name="tab-header"></tab-header>
        <view class="l-tabs-main">
            <view v-if="(!swipeable)" class="l-tabpanel-content l-content-class">
                <view v-for="(item,index) in (tabList)" :key="item.key" :class="'l-tabpanel '+(item.key===activeKey?'l-tabpanel-active':'l-tabpanel-inactive')" :style="placement=='left'||placement=='right' ? 'position:absolute;width:100%;height:100%;transform:translate(0,'+ 100 * index +'%) translateZ(0px);':''">
                    <view class="l-subpanel-content" v-if="item.subTabs.length>0" :style="'transform:translate(0,'+ -100 * item.subCurrentIndex +'%) translateZ(0px);'">
                        <view v-for="(tab,index) in (item.subTabs)" :key="tab.key" class="l-subpanel">
                            <slot :name="tab.key"></slot>
                        </view>
                    </view>
                    <slot :name="item.key" v-else></slot>
                </view>
            </view>
            <swiper v-else class="l-tabpanel-content l-content-class" @change="swiperChange" :current="currentIndex">
                <swiper-item v-for="(item,index) in (tabList)" :key="item.key" :class="'l-tabpanel '+(item.key===activeKey?'l-tabpanel-active':'')">
                    <view v-if="item.subTabs.length>0">
                        <swiper class vertical @change="subSwiperChange" :current="item.subCurrentIndex">
                            <swiper-item v-for="(tab,index) in (item.subTabs)" :key="tab.key">
                                <slot :name="tab.key"></slot>
                            </swiper-item>
                        </swiper>

                    </view>
                      <slot :name="item.key" v-else></slot>
                </swiper-item>
            </swiper>
        </view>
    </view>
</view>
<template v-if="wxTemplateName === 'tab-header'">
    <scroll-view :scroll-x="headerType==='tab' && scrollable" :scroll-y="headerType==='subTab' && scrollable" :scroll-top="transformY" :scroll-left="transformX" scroll-with-animation class="l-tabsscroll">
        <view :class="'l-tabs-header l-class-header l-header-class '+(hasLine?'l-tabs-header-line':'')">
            <view v-for="(item,index) in (tab)" :key="item.key" :id="item.key" :class="'l-tabs-item '+(item.key===activeKey ?'l-class-active l-active-class l-tabs-active':'l-class-inactive l-inactive-class l-tabs-inactive')+' '+('l-tab-image-placement-'+item.image.placement)" :style="'color:'+(item.key===activeKey?activeColor:inactiveColor)" :data-key="item.key" :data-index="index" :data-header-type="headerType" mut-bind:tap="handleChange">
                <image v-if="item.image.activeImage || item.image.defaultImage" :src="item.key===activeKey? item.image.activeImage:item.image.defaultImage" class="l-tab-image l-class-tabimage l-tabimage-class"></image>
                <l-icon v-if="item.icon" :l-class="item.key===activeKey ? 'l-icon-active':'l-icon-inactive'" :name="item.icon" size="28" :color="item.key===activeKey?activeColor:inactiveColor"></l-icon>
                {{item.tab}}
                <view class="l-tab-line l-class-line l-line-class" v-if="hasLine && item.key===activeKey" :style="'background:'+(item.key===activeKey?activeColor:inactiveColor)"></view>
            </view>
        </view>
    </scroll-view>
</template></uni-shadow-root>
</template>

<script>
import LIcon from '../icon/index.vue'
import LBadge from '../badge/index.vue'
global['__wxVueOptions'] = {components:{'l-icon': LIcon,'l-badge': LBadge}}

global['__wxRoute'] = 'lin-ui/dist/combined-tabs/index'
import nodeUtil from"../core/utils/node-util";Component({externalClasses:["l-class-header","l-class-active","l-class-inactive","l-class-line","l-class-tabimage","l-header-class","l-active-class","l-inactive-class","l-line-class","l-tabimage-class","l-content-class"],relations:{"../tabpanel/index":{type:"child"},linked(){this.initTabs()}},options:{multipleSlots:!0},properties:{activeKey:{type:String,value:"",observer:"changeCurrent"},placement:{type:String,value:"top"},aminmated:Boolean,scrollable:Boolean,swipeable:{type:Boolean,value:!0},hasLine:{type:Boolean,value:!0},activeColor:{type:String,value:"#333333"},inactiveColor:{type:String,value:"#bbbbbb"}},data:{tabList:[],currentIndex:0,transformX:0,transformY:0},ready(){this.initTabs()},methods:{initTabs(){this.initTabList(),this.initActiveIndex()},initActiveIndex(t=this.data.activeKey){let e=t,a=this.data.currentIndex;this.data.tabList.forEach((s,i)=>{e=t||0!==i?e:s.key,a=s.key===e?i:a}),this.setData({activeKey:e,currentIndex:a},()=>{this.data.scrollable&&this.queryMultipleNodes()})},initTabList(){let t=this.getRelationNodes("../tabpanel/index");if(t.length>0){const e=[];t.forEach(t=>{const a=e.findIndex(e=>e.tab===t.data.tab);let s={};-1===a&&(s={tab:t.data.tab,key:t.data.key,icon:t.data.icon,iconStyle:t.data.iconStyle,image:t.data.image,subTabs:[]},e.push(s));const i=-1===a?s:e[a];if(t.data.subTab){i.subTabs=i.subTabs||[];const e={tab:t.data.subTab,key:t.data.subKey};i.subTabs.push(e),i.activeSubKey=this.data.subActiveKey||i.subTabs[0].key,i.subCurrentIndex=0}}),this.setData({tabList:e})}},swiperChange(t){const{source:e,current:a}=t.detail;if("touch"===e){const t=a,e=this.data.tabList[a].key,s=this.data.tabList[t].subCurrentIndex,i=this.data.tabList[t].activeSubKey;this._setChangeData({activeKey:e,currentIndex:t,subCurrentIndex:s,activeSubKey:i})}},subSwiperChange(t){const{source:e,current:a}=t.detail;if("touch"===e){const{currentIndex:t,activeKey:e}=this.data,s=a,i=this.data.tabList[t].subTabs[s].key,n=this.data.tabList[t];n.activeSubKey=i,n.subCurrentIndex=s,this.setData({[`tabList[${t}]`]:n}),this._setChangeData({activeKey:e,currentIndex:t,activeSubKey:i,subCurrentIndex:s})}},handleChange(t){const e="subTab"===t.currentTarget.dataset.headerType,{currentIndex:a,activeKey:s}=this.data,i=t.currentTarget.dataset.index,n=e?i:this.data.tabList[i].subCurrentIndex,r=e?this.data.tabList[a].subTabs[n].key:this.data.tabList[i].activeSubKey;if(e){const t=this.data.tabList[a];t.activeSubKey=r,t.subCurrentIndex=n,this.setData({[`tabList[${a}]`]:t}),this._setChangeData({activeKey:s,currentIndex:a,activeSubKey:r,subCurrentIndex:n})}else{const e=t.currentTarget.dataset.key;this._setChangeData({activeKey:e,currentIndex:i,subCurrentIndex:n,activeSubKey:r})}},_setChangeData({activeKey:t,currentIndex:e,activeSubKey:a="",subCurrentIndex:s=null}){this.setData({activeKey:t,currentIndex:e},()=>{this.data.scrollable&&this.queryMultipleNodes()}),this.triggerEvent("linchange",{activeKey:t,currentIndex:e,activeSubKey:a,subCurrentIndex:s})},async queryMultipleNodes(){const{placement:t,activeKey:e,tabList:a}=this.data,s=await nodeUtil.getNodeRectFromComponent(this,"#"+e);if(-1!==["top","bottom"].indexOf(t))this.setData({transformX:s.left-a.length/2*s.width,transformY:0});else{const t=await nodeUtil.getNodeRectFromComponent(this,".l-tabs-header"),e=s.top-t.top-t.height/2;this.setData({transformX:0,transformY:e})}}}});
export default global['__wxComponents']['lin-ui/dist/combined-tabs/index']
</script>
<style platform="mp-weixin">
.l-tabs{display:flex;border-radius:8rpx;box-sizing:border-box;overflow:hidden;flex-direction:column;background:#fff;height:100%}.l-tabs .l-tabs-header{display:flex;width:100%;flex-direction:row;background:#fff;align-items:center}.l-tabs .l-tabs-header .l-tabs-item{flex:1;font-size:28rpx;text-align:center;box-sizing:border-box;display:flex;justify-content:center;align-items:center}.l-tabs .l-tabs-header .l-icon-active,.l-tabs .l-tabs-header .l-tabs-active{color:#333;font-size:28rpx}.l-tabs .l-tabs-header .l-icon-inactive,.l-tabs .l-tabs-header .l-tabs-inactive{font-size:28rpx;color:#bbb}.l-tabs .l-tabs-header .l-tabsitems-row{flex-direction:row}.l-tabs .l-tabs-header .l-tabsitems-row .l-icon-active,.l-tabs .l-tabs-header .l-tabsitems-row .l-icon-inactive{margin-right:10rpx}.l-tabs .l-tabs-header .l-tabsitems-row-reverse{flex-direction:row-reverse}.l-tabs .l-tabs-header .l-tabsitems-row-reverse .l-icon-active,.l-tabs .l-tabs-header .l-tabsitems-row-reverse .l-icon-inactive{margin-left:10rpx}.l-placement-top .l-tabs-header{height:80rpx}.l-placement-top .l-tabs-header .l-tabs-item{min-height:100%}.l-sub-placement-left{flex-direction:row}.l-sub-placement-left .l-tabs-header{flex-direction:column;width:160rpx}.l-sub-placement-left .l-tabs-header>.l-tabs-item{width:100%;height:80rpx;background:#f6f8fa}.l-sub-placement-left .l-tabs-header>.l-tabs-active{background:#fff}.l-sub-placement-left .l-tabs-main .l-tabpanel-content{width:100%;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;position:relative;will-change:transform;transition:transform .3s cubic-bezier(.645,.045,.355,1)}.l-placement-top .l-tabpanel-content{width:100%;height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row}.l-subpanel-content{width:100%;height:100%}.l-tabpanel{width:100%;height:100%;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:opacity .45s;transition:opacity .45s;opacity:1;text-overflow:ellipsis}.l-tabpanel-inactive{opacity:0;height:0;padding:0!important;pointer-events:none}.l-subpanel{height:100%}.l-tabs-scroll.l-tabs-horizontal .l-tabs-header{-webkit-overflow-scrolling:touch;white-space:nowrap}.l-tabs-scroll.l-tabs-horizontal .l-tabs-header .l-tabs-item{overflow:visible;min-width:160rpx}.l-tabs-scroll.l-tabs-horizontal .l-tabpanel-content{height:150px}.l-tabs-vertical .l-tabsscroll{width:160rpx}.l-tabs-vertical .l-tabs-header{height:100%;min-height:80rpx;-webkit-overflow-scrolling:touch;white-space:nowrap}.l-tabs-vertical .l-tabs-header .l-tabs-item{overflow:visible;min-height:80rpx}.l-tabs-item{position:relative}.l-tab-line{position:absolute;bottom:0;left:0;right:0;width:0;background:#000}.l-tabs-horizontal .l-tab-line{height:4rpx;margin:0 auto}.l-tabs-horizontal .l-tabs-active .l-tab-line{width:100%;transition-delay:.1s}.l-placement-top .l-tab-line{bottom:0}.l-placement-top .l-tabs-header-line{border-bottom:1px solid #f3f3f3}.l-tabs-vertical .l-tabs-active .l-tab-line{width:6rpx!important;height:40rpx!important;border-radius:0 6rpx 6rpx 0;top:0;left:0;margin:auto 0;transition-delay:.1s}.l-sub-placement-left .l-tab-line{left:0;right:auto}.l-sub-placement-left .l-tabs-header-line{border-right:1px solid #f3f3f3}.l-tab-image{width:100rpx;height:100rpx}.l-tab-image-placement-top{flex-direction:column}.l-tab-image-placement-left{flex-direction:row}.l-tabs-main{flex:1}.l-combined-tabs-main{display:flex}
</style>